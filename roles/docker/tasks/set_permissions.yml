---
- name: Ensure /opt/airconcheck exists with correct ownership
  file:
    path: "{{ global_defaults.app_base_path }}"
    state: directory
    owner: dockeruser
    group: dockeruser
    mode: '0775'

- name: Set correct ownership and permissions for service directories
  file:
    path: "{{ item.path }}"
    state: directory
    owner: "{{ item.owner }}"
    group: "{{ item.group }}"
    mode: "{{ item.mode }}"
  loop:
    - { path: "{{ global_defaults.app_base_path }}/portainer", owner: "dockeruser", group: "dockeruser", mode: "0775" }
    - { path: "{{ global_defaults.app_base_path }}/swag/external", owner: "dockeruser", group: "dockeruser", mode: "0775" }
    - { path: "{{ global_defaults.app_base_path }}/swag/internal", owner: "dockeruser", group: "dockeruser", mode: "0775" }

- name: Ensure content directories exist (landpage/html, angular-ssr, backend) with strict ownership
  file:
    path: "{{ item }}"
    state: directory
    owner: dockeruser
    group: dockeruser
    mode: '0775'
  loop:
    - "{{ global_defaults.app_base_path }}/landpage/html"
    - "{{ global_defaults.app_base_path }}/landpage/nginx"
    - "{{ global_defaults.angular_ssr_build_context | default(global_defaults.app_base_path + '/angular-ssr') }}"
    - "{{ global_defaults.backend_build_context | default(global_defaults.app_base_path + '/backend') }}"
    - "{{ global_defaults.app_base_path }}/netdata/config"
    - "{{ global_defaults.app_base_path }}/netdata/lib"
    - "{{ global_defaults.app_base_path }}/netdata/cache"

