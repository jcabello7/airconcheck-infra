version: '3.8'
services:
  {{ global_defaults.docker_proxy_container_name }}:
    image: {{ global_defaults.docker_proxy_image }}
    container_name: {{ global_defaults.docker_proxy_container_name }}
    networks:
      - management
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
{% set env = global_defaults.docker_proxy_env | default({}) %}
{% if env %}
    environment:
{% for key, value in env.items() %}
      {{ key }}: "{{ value }}"
{% endfor %}
{% endif %}
    restart: unless-stopped
networks:
  management:
    external: true