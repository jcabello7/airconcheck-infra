---
# Base paths
mongo_pbm_base_dir: /opt/airconcheck/mongo_pbm
mongo_pbm_config_dir: "{{ mongo_pbm_base_dir }}/config"
mongo_pbm_backups_dir: "{{ mongo_pbm_base_dir }}/backups"
mongo_pbm_compose_file: "{{ mongo_pbm_base_dir }}/docker-compose.mongo-pbm.yml"
mongo_pbm_config_file: "{{ mongo_pbm_config_dir }}/pbm-config.yaml"
mongo_pbm_scripts_dir: "{{ mongo_pbm_base_dir }}/bin"
mongo_pbm_state_dir: "{{ mongo_pbm_base_dir }}/state"

# Ownership and permissions
mongo_pbm_user: root
mongo_pbm_group: root
mongo_pbm_dir_mode: "0750"
mongo_pbm_config_mode: "0600"

# Container settings
mongo_pbm_image: "percona/percona-backup-mongodb:latest"
mongo_pbm_container_name: "mongo-pbm-backup"
mongo_pbm_service_name: "mongo_pbm_backup"
mongo_pbm_compose_project_name: "mongo_pbm_backup"
mongo_pbm_docker_network: "internal_db"
mongo_pbm_docker_binary: "/usr/bin/docker"
mongo_pbm_container_user: "0:0"
mongo_pbm_extra_environment: {}

# MongoDB connection handling
mongo_pbm_replicaset_members:
  - "mongo1:27017"
  - "mongo2:27017"
  - "mongo3:27017"
mongo_pbm_replicaset_name: "{{ mongo_replicaset_name | default('rs0') }}"
mongo_pbm_auth_db: "admin"
mongo_pbm_target_db: "{{ mongo_app_db | default('airconcheck') }}"
mongo_pbm_mongodb_user: "{{ mongo_pmm_user | default('airconcheck-pmm') }}"
mongo_pbm_mongodb_password: "{{ mongo_pmm_password | default('') }}"
mongo_pbm_mongodb_uri: ""

# Storage configuration
mongo_pbm_storage_type: "s3"
mongo_pbm_filesystem_path: "{{ mongo_pbm_backups_dir }}"

# Backup scheduling and execution
mongo_pbm_backup_oncalendar: "daily"  # legacy variable kept for backwards compatibility
mongo_pbm_daily_backup_oncalendar: "{{ mongo_pbm_backup_oncalendar }}"
mongo_pbm_weekly_backup_oncalendar: "Sun *-*-* 03:30:00"
mongo_pbm_backup_description_prefix: "scheduled"
mongo_pbm_daily_backup_description_prefix: "{{ mongo_pbm_backup_description_prefix }}"
mongo_pbm_weekly_backup_description_prefix: "weekly"
mongo_pbm_backup_extra_args: "--compression=s2"
mongo_pbm_daily_backup_extra_args: "{{ mongo_pbm_backup_extra_args }}"
mongo_pbm_weekly_backup_extra_args: "{{ mongo_pbm_backup_extra_args }}"
mongo_pbm_weekly_backup_enabled: true
mongo_pbm_daily_retention_days: 31
mongo_pbm_weekly_retention_weeks: 52
mongo_pbm_weekly_retention_days: "{{ mongo_pbm_weekly_retention_weeks * 7 }}"
mongo_pbm_daily_cleanup_oncalendar: "*-*-* 03:30:00"
mongo_pbm_weekly_cleanup_oncalendar: "Sun *-*-* 04:30:00"
mongo_pbm_daily_cleanup_enabled: true
mongo_pbm_weekly_cleanup_enabled: "{{ mongo_pbm_weekly_backup_enabled }}"
mongo_pbm_systemd_service: "mongo-pbm-backup.service"
mongo_pbm_systemd_timer: "mongo-pbm-backup.timer"
mongo_pbm_weekly_systemd_service: "mongo-pbm-weekly-backup.service"
mongo_pbm_weekly_systemd_timer: "mongo-pbm-weekly-backup.timer"
mongo_pbm_daily_cleanup_service: "mongo-pbm-daily-cleanup.service"
mongo_pbm_daily_cleanup_timer: "mongo-pbm-daily-cleanup.timer"
mongo_pbm_weekly_cleanup_service: "mongo-pbm-weekly-cleanup.service"
mongo_pbm_weekly_cleanup_timer: "mongo-pbm-weekly-cleanup.timer"
mongo_pbm_systemd_unit_dir: "/etc/systemd/system"
mongo_pbm_scheduler_script: "{{ mongo_pbm_scripts_dir }}/mongo-pbm-scheduler.py"
mongo_pbm_daily_log_file: "{{ mongo_pbm_state_dir }}/daily-backups.jsonl"
mongo_pbm_weekly_log_file: "{{ mongo_pbm_state_dir }}/weekly-backups.jsonl"

# PBM behavior
mongo_pbm_apply_config: true
